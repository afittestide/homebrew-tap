# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class Asimi < Formula
  desc "AI-powered CLI assistant with container support - safe, opinionated coding agent"
  homepage "https://github.com/afittestide/asimi-cli"
  version "0.2.0-rc.2"
  license "MIT"

  depends_on "podman" => :optional

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/afittestide/asimi-cli/releases/download/v0.2.0-rc.2/asimi_0.2.0-rc.2_darwin_amd64.tar.gz"
      sha256 "bd4dc8a05a4f0c84f3b19bf4266550f9c266da826ce75eba0caa9455fcd0636a"

      def install
        bin.install "asimi"

        # Install example configuration
        (etc/"asimi").install "conf.toml.example" => "asimi.toml.example"

        # Install shell completions if available
        if File.exist?("completions/asimi.bash")
          bash_completion.install "completions/asimi.bash" => "asimi"
        end
        if File.exist?("completions/asimi.zsh")
          zsh_completion.install "completions/asimi.zsh" => "_asimi"
        end
        if File.exist?("completions/asimi.fish")
          fish_completion.install "completions/asimi.fish"
        end
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/afittestide/asimi-cli/releases/download/v0.2.0-rc.2/asimi_0.2.0-rc.2_darwin_arm64.tar.gz"
      sha256 "d2c14816d48dbb1976db97ce7a389778a71702f2e0a5f084aa244aa600a948d6"

      def install
        bin.install "asimi"

        # Install example configuration
        (etc/"asimi").install "conf.toml.example" => "asimi.toml.example"

        # Install shell completions if available
        if File.exist?("completions/asimi.bash")
          bash_completion.install "completions/asimi.bash" => "asimi"
        end
        if File.exist?("completions/asimi.zsh")
          zsh_completion.install "completions/asimi.zsh" => "_asimi"
        end
        if File.exist?("completions/asimi.fish")
          fish_completion.install "completions/asimi.fish"
        end
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel? && Hardware::CPU.is_64_bit?
      url "https://github.com/afittestide/asimi-cli/releases/download/v0.2.0-rc.2/asimi_0.2.0-rc.2_linux_amd64.tar.gz"
      sha256 "277777fa0aaaa54030be0a62fcc4bfa6e1fbaaabb88606677c0f5f7df282942e"
      def install
        bin.install "asimi"

        # Install example configuration
        (etc/"asimi").install "conf.toml.example" => "asimi.toml.example"

        # Install shell completions if available
        if File.exist?("completions/asimi.bash")
          bash_completion.install "completions/asimi.bash" => "asimi"
        end
        if File.exist?("completions/asimi.zsh")
          zsh_completion.install "completions/asimi.zsh" => "_asimi"
        end
        if File.exist?("completions/asimi.fish")
          fish_completion.install "completions/asimi.fish"
        end
      end
    end
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/afittestide/asimi-cli/releases/download/v0.2.0-rc.2/asimi_0.2.0-rc.2_linux_arm64.tar.gz"
      sha256 "f1094835ab4215eb2f86bcf2e3041fa0f961403840c9bb7d80dadebcf490a8de"
      def install
        bin.install "asimi"

        # Install example configuration
        (etc/"asimi").install "conf.toml.example" => "asimi.toml.example"

        # Install shell completions if available
        if File.exist?("completions/asimi.bash")
          bash_completion.install "completions/asimi.bash" => "asimi"
        end
        if File.exist?("completions/asimi.zsh")
          zsh_completion.install "completions/asimi.zsh" => "_asimi"
        end
        if File.exist?("completions/asimi.fish")
          fish_completion.install "completions/asimi.fish"
        end
      end
    end
  end

  def caveats
    <<~EOS
      Asimi requires Podman for containerized shell execution.
      Install it with: brew install podman

      Example configuration has been installed to:
        #{etc}/asimi/asimi.toml.example

      Copy it to get started:
        mkdir -p ~/.config/asimi
        cp #{etc}/asimi/asimi.toml.example ~/.config/asimi/asimi.toml

      For more information, see: https://github.com/afittestide/asimi-cli
    EOS
  end

  test do
    system "#{bin}/asimi", "--version"
    assert_match "asimi version", shell_output("#{bin}/asimi --version")
  end
end
